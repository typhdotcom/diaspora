/-
Gauge Negotiation: Verified Data Layer

Data for gauge negotiation verification: graphs, constraints, optimal phases, and costs.
-/

import Mathlib.Data.Real.Basic
import Mathlib.Data.Finset.Basic
import Mathlib.Tactic

namespace Diaspora.GaugeNegotiationVerified

open BigOperators

/-! ## Graph Structures -/

/-- 8-node system -/
abbrev V := Fin 8

/-- A directed graph on V represented by adjacency relation -/
structure DiGraph where
  adj : V → V → Bool
  deriving DecidableEq

/-- Edge count of a directed graph -/
def DiGraph.edgeCount (G : DiGraph) : ℕ :=
  (Finset.univ.product Finset.univ).filter (fun (i, j) => G.adj i j) |>.card

/-- Notation for Fin 8 values -/
local notation "n0" => (0 : Fin 8)
local notation "n1" => (1 : Fin 8)
local notation "n2" => (2 : Fin 8)
local notation "n3" => (3 : Fin 8)
local notation "n4" => (4 : Fin 8)
local notation "n5" => (5 : Fin 8)
local notation "n6" => (6 : Fin 8)
local notation "n7" => (7 : Fin 8)

/-- Define G_A: Rigid conservator (20 edges, optimized for λ=10.0) -/
def G_A : DiGraph where
  adj i j :=
    ((i, j) == (n0, n1)) || ((i, j) == (n1, n2)) || ((i, j) == (n1, n5)) || ((i, j) == (n1, n7)) ||
    ((i, j) == (n2, n0)) || ((i, j) == (n2, n3)) || ((i, j) == (n2, n5)) || ((i, j) == (n2, n7)) ||
    ((i, j) == (n3, n1)) || ((i, j) == (n3, n7)) || ((i, j) == (n4, n0)) || ((i, j) == (n4, n2)) ||
    ((i, j) == (n4, n6)) || ((i, j) == (n4, n7)) || ((i, j) == (n5, n2)) || ((i, j) == (n5, n4)) ||
    ((i, j) == (n5, n7)) || ((i, j) == (n6, n3)) || ((i, j) == (n7, n2)) || ((i, j) == (n7, n6))

/-- Define G_B: Adaptive pragmatist (37 edges, optimized for λ=0.1) -/
def G_B : DiGraph where
  adj i j :=
    ((i, j) == (n0, n2)) || ((i, j) == (n0, n3)) || ((i, j) == (n0, n5)) || ((i, j) == (n0, n6)) ||
    ((i, j) == (n1, n2)) || ((i, j) == (n1, n3)) || ((i, j) == (n1, n4)) || ((i, j) == (n1, n6)) ||
    ((i, j) == (n1, n7)) || ((i, j) == (n2, n0)) || ((i, j) == (n2, n1)) || ((i, j) == (n2, n3)) ||
    ((i, j) == (n2, n5)) || ((i, j) == (n2, n6)) || ((i, j) == (n2, n7)) || ((i, j) == (n3, n0)) ||
    ((i, j) == (n3, n1)) || ((i, j) == (n3, n2)) || ((i, j) == (n3, n4)) || ((i, j) == (n3, n6)) ||
    ((i, j) == (n3, n7)) || ((i, j) == (n4, n2)) || ((i, j) == (n4, n3)) || ((i, j) == (n5, n1)) ||
    ((i, j) == (n5, n2)) || ((i, j) == (n5, n3)) || ((i, j) == (n5, n4)) || ((i, j) == (n5, n7)) ||
    ((i, j) == (n6, n0)) || ((i, j) == (n6, n1)) || ((i, j) == (n6, n3)) || ((i, j) == (n6, n5)) ||
    ((i, j) == (n7, n0)) || ((i, j) == (n7, n2)) || ((i, j) == (n7, n3)) || ((i, j) == (n7, n4)) ||
    ((i, j) == (n7, n5))

/-- Define G_N: Negotiated graph (34 edges, emerged from G_A ⊔ G_B under λ=1.0) -/
def G_N : DiGraph where
  adj i j :=
    ((i, j) == (n0, n2)) || ((i, j) == (n0, n3)) || ((i, j) == (n0, n5)) || ((i, j) == (n1, n2)) ||
    ((i, j) == (n1, n3)) || ((i, j) == (n1, n4)) || ((i, j) == (n1, n6)) || ((i, j) == (n1, n7)) ||
    ((i, j) == (n2, n0)) || ((i, j) == (n2, n1)) || ((i, j) == (n2, n3)) || ((i, j) == (n2, n5)) ||
    ((i, j) == (n2, n6)) || ((i, j) == (n2, n7)) || ((i, j) == (n3, n0)) || ((i, j) == (n3, n2)) ||
    ((i, j) == (n3, n4)) || ((i, j) == (n3, n6)) || ((i, j) == (n3, n7)) || ((i, j) == (n4, n2)) ||
    ((i, j) == (n4, n3)) || ((i, j) == (n5, n1)) || ((i, j) == (n5, n3)) || ((i, j) == (n5, n4)) ||
    ((i, j) == (n5, n7)) || ((i, j) == (n6, n0)) || ((i, j) == (n6, n1)) || ((i, j) == (n6, n3)) ||
    ((i, j) == (n6, n5)) || ((i, j) == (n7, n0)) || ((i, j) == (n7, n2)) || ((i, j) == (n7, n3)) ||
    ((i, j) == (n7, n4)) || ((i, j) == (n7, n5))

/-- Define G_Union: Union of G_A and G_B (43 edges) -/
def G_Union : DiGraph where
  adj i j := G_A.adj i j || G_B.adj i j

/-- Negotiation complexity parameter -/
def lam_N : ℝ := 1.0

/-! ## Constraint Matrix -/

def C_initial (i j : Fin 8) : ℝ :=
  match (i.val, j.val) with
  | (0, 1) => -0.788287681898749
  | (0, 2) => 2.8319215077704234
  | (0, 3) => 1.4576609265440963
  | (0, 4) => 0.6198895383354297
  | (0, 5) => -2.1612986243157413
  | (0, 6) => -2.1614501754128375
  | (0, 7) => -2.776642555026645
  | (1, 0) => 2.3007525789727232
  | (1, 2) => 0.6353243561202211
  | (1, 3) => 1.3073585636350948
  | (1, 4) => -3.012256461474685
  | (1, 5) => 2.952530678803174
  | (1, 6) => 2.088798716157191
  | (1, 7) => -1.8074266732364683
  | (2, 0) => -1.9991526911557285
  | (2, 1) => -1.9892281320082241
  | (2, 3) => -1.2299822628030639
  | (2, 4) => 0.15554924748987276
  | (2, 5) => -0.427602058948239
  | (2, 6) => -1.3117459988749123
  | (2, 7) => 0.7027924646851598
  | (3, 0) => -2.265126877899127
  | (3, 1) => -1.3059936903421663
  | (3, 2) => -0.8396733026956396
  | (3, 4) => -0.27602042971168705
  | (3, 5) => 1.7918134105853962
  | (3, 6) => -1.8870052793034098
  | (3, 7) => 0.0894376142963571
  | (4, 0) => 0.5806578612433215
  | (4, 1) => -2.8497361028750756
  | (4, 2) => 0.6757242333299223
  | (4, 3) => -2.0701579851181284
  | (4, 5) => -2.732861440336058
  | (4, 6) => 2.8204310122755585
  | (4, 7) => 2.9256523487662305
  | (5, 0) => 1.9377176864584964
  | (5, 1) => -1.2276478947550764
  | (5, 2) => -2.5279006619437125
  | (5, 3) => 1.1575702452784116
  | (5, 4) => -0.3760329720066755
  | (5, 6) => -2.374803809498947
  | (5, 7) => -0.030304367524073506
  | (6, 0) => -2.925523202983018
  | (6, 1) => 2.5718359362702436
  | (6, 2) => -1.5156300754083631
  | (6, 3) => 1.021157629142202
  | (6, 4) => -1.1830542002196682
  | (6, 5) => 0.12609109580858968
  | (6, 7) => 0.29348934086394873
  | (7, 0) => -1.9801178546651192
  | (7, 1) => 2.95048723364767
  | (7, 2) => 1.7287105132653915
  | (7, 3) => 2.7614532921570927
  | (7, 4) => 2.480773407079649
  | (7, 5) => 0.6151237084390031
  | (7, 6) => 2.6507139949748755
  | _ => 0.0

/-! ## Optimal Phases from Python -/

def phases_G_A : Fin 8 → ℝ
  | 0 => 0.0
  | 1 => -1.243434645176955
  | 2 => -3.0420758764972904
  | 3 => 2.1944015539952777
  | 4 => -2.578577224636355
  | 5 => -0.26498098248772817
  | 6 => 1.3566960103236836
  | 7 => 1.4118372657472489

def phases_G_B : Fin 8 → ℝ
  | 0 => 0.0
  | 1 => 1.5528596711856562
  | 2 => 2.0925234104377557
  | 3 => 2.9897188270684665
  | 4 => -1.936018825000942
  | 5 => -2.4458196038794506
  | 6 => -3.1367477660919905
  | 7 => 2.222978956154161

def phases_G_N : Fin 8 → ℝ
  | 0 => 0.0
  | 1 => 0.9642376663697859
  | 2 => 1.8965222579026955
  | 3 => 2.470673943090315
  | 4 => -2.3304557732701516
  | 5 => -2.1721405116382484
  | 6 => 3.1101792163016655
  | 7 => 1.756653556370444

def phases_G_Union : Fin 8 → ℝ
  | 0 => 0.0
  | 1 => -0.31870044473292997
  | 2 => 1.8663450270850783
  | 3 => 0.5545044131348005
  | 4 => 2.116199997092937
  | 5 => -2.0760749126461544
  | 6 => -2.333557954758622
  | 7 => -1.8789022754841405

/-! ## Job Definitions -/

def pi_over_2 : ℝ := 1.5707963267948966
def pi_over_4 : ℝ := 0.7853981633974483
def V_ext (φ : Fin 8 → ℝ) : ℝ :=
  50.0 * (φ 7 - φ 0 - pi_over_2)^2 + 50.0 * (φ 7 - φ 1 - pi_over_4)^2

def V_ext_G_A : ℝ := V_ext phases_G_A
def V_ext_G_B : ℝ := V_ext phases_G_B
def V_ext_G_N : ℝ := V_ext phases_G_N
def V_ext_G_Union : ℝ := V_ext phases_G_Union

end Diaspora.GaugeNegotiationVerified
